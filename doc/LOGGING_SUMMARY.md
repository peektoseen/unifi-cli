# Сводка: Улучшенное логирование UniFi CLI

## Что добавлено

### ✅ Базовое логирование
- Логи INFO для всех основных операций
- Логи DEBUG для детальной отладки (флаг `-d`)
- Логи ERROR с описанием проблем
- Временные метки для всех сообщений

### ✅ Расширенная диагностика API
- **HTTP коды ответов** - точное определение типа ошибки
- **Содержимое ответов** - первые 200 символов в DEBUG режиме
- **Умная обработка ошибок**:
  - HTTP 000: Сервер недоступен + рекомендации
  - HTTP 401: Ошибка авторизации
  - HTTP 403: Доступ запрещен
  - HTTP 404: Ресурс не найден
  - HTTP 500+: Ошибки сервера
  - Пустые ответы

### ✅ Логирование во всех компонентах
- Основной скрипт `unifi`
- API библиотека `unifi_sh_api`
- Неофициальное API `unifi_sh_api_nonofficial`
- Примерный скрипт `my-unifi-script.sh`

## Пример вывода

### Нормальный режим
```bash
$ ./unifi --list
[2025-10-16 19:15:48] [INFO] Запуск UniFi CLI версии 0.1.3_alpha
[2025-10-16 19:15:48] [INFO] Загрузка конфигурационного файла: ./unifi.conf
[2025-10-16 19:15:48] [INFO] Загрузка библиотеки API: unifi_sh_api
[2025-10-16 19:15:48] [INFO] Попытка авторизации в UniFi Controller
...
```

### Режим отладки (DEBUG)
```bash
$ ./unifi -d --list
[2025-10-16 19:15:48] [DEBUG] Аргументы командной строки: -d --list
[2025-10-16 19:15:48] [DEBUG] Путь к скрипту: /path/to/unifi
[2025-10-16 19:15:48] [API-DEBUG] Выполнение запроса: https://controller:8443/api/login
[2025-10-16 19:15:48] [API-DEBUG] HTTP код ответа: 200
[2025-10-16 19:15:48] [API-DEBUG] Тело ответа: {"meta":{"rc":"ok"}...
...
```

### При ошибке подключения
```bash
$ ./unifi -d --list
...
[2025-10-16 19:16:42] [API-DEBUG] HTTP код ответа: 000
[2025-10-16 19:16:42] [API-ERROR] Ошибка подключения: сервер недоступен (HTTP 000)
[2025-10-16 19:16:42] [API-ERROR] Проверьте: 1) доступность сервера, 2) правильность URL в конфигурации, 3) сетевое подключение
```

## Как использовать

### Отладка проблем
```bash
./unifi -d --list 2>&1 | less
```

### Сохранение логов
```bash
./unifi --list 2> logs.txt
```

### Поиск ошибок
```bash
./unifi --list 2>&1 | grep ERROR
```

### Только результаты (без логов)
```bash
./unifi --list 2> /dev/null
```

## Преимущества

1. **Быстрая диагностика** - сразу видно где проблема
2. **Детальная информация** - HTTP коды, содержимое ответов
3. **Рекомендации** - что проверить при ошибке
4. **Гибкость** - можно разделить логи и результаты
5. **Прозрачность** - понятно что происходит на каждом шаге

## Решение вашей проблемы

**Ошибка:** `Expecting value: line 1 column 1 (char 0)`

**Причина:** Сервер вернул пустой ответ (не JSON)

**Теперь видно:**
```
[API-ERROR] Ошибка подключения: сервер недоступен (HTTP 000)
[API-ERROR] Проверьте: 1) доступность сервера, 2) правильность URL в конфигурации, 3) сетевое подключение
```

**Решение:**
1. Проверьте доступность сервера: `ping unificontroller`
2. Проверьте URL в файле `unifi.conf` - должен быть реальный IP или hostname
3. Убедитесь, что UniFi Controller запущен и доступен на порту 8443

## Дополнительная документация

- `LOGGING.md` - полная документация по логированию
- `CHANGELOG_LOGGING.md` - детальный список изменений

## Проверка

Протестируйте:
```bash
# Базовая проверка
./unifi -v

# С отладкой
./unifi -d -v

# Реальная команда (если controller доступен)
./unifi --list
./unifi -d --list
```

