# Изменения: Добавление логирования

## Дата: 2025-10-16

### Обзор изменений
Добавлено подробное логирование во все скрипты проекта для улучшения отладки и мониторинга операций.

## Измененные файлы

### 1. `unifi` (основной скрипт)
**Добавлено:**
- Функции логирования: `log()`, `log_info()`, `log_error()`, `log_debug()`
- Раннее определение DEBUG режима для корректной работы отладочных логов с самого начала
- Логи для всех основных операций:
  - Запуск скрипта с версией
  - Загрузка конфигурации
  - Загрузка библиотек API
  - Обработка команд (list, reboot, upgrade, show)
  - Обработка опций (rolling, debug, help, version)
  - Авторизация и выход
  - Завершение работы

### 2. `unifi_sh_api` (библиотека официального API)
**Добавлено:**
- Функции логирования: `api_log()`, `api_log_info()`, `api_log_debug()`
- Префикс `[API-INFO]` и `[API-DEBUG]` для идентификации логов API
- Логи для всех функций API:
  - `unifi_login()` - авторизация
  - `unifi_logout()` - выход
  - `unifi_api()` - общие вызовы API
  - `unifi_authorize_guest()` - авторизация гостей
  - `unifi_backup()` - резервное копирование
  - `unifi_create_voucher()` - создание ваучеров
  - `unifi_list_sta()` - список станций
  - `unifi_upgrade_external()` - обновление с внешней прошивкой

### 3. `unifi_sh_api_nonofficial` (библиотека неофициального API)
**Добавлено:**
- Использует функции логирования из `unifi_sh_api`
- Логи для всех функций:
  - `unifi_list_dev()` - список устройств
  - `unifi_list_ap()` - список точек доступа
  - `unifi_reboot_dev()` - перезагрузка устройства
  - `unifi_reboot_all_ap()` - постепенная перезагрузка всех AP
  - `unifi_upgrade_dev()` - обновление устройства
  - `unifi_ap_rolling_upgrade()` - постепенное обновление
  - `unifi_ap_rolling_upgrade_cancel()` - отмена обновления

### 4. `my-unifi-script.sh` (примерный скрипт)
**Добавлено:**
- Функции логирования: `script_log()`, `script_log_info()`, `script_log_debug()`
- Префикс `[SCRIPT-INFO]` и `[SCRIPT-DEBUG]`
- Логи для:
  - Запуск скрипта
  - Загрузка конфигурации
  - Загрузка библиотек
  - Авторизация и выход
  - Завершение работы

### 5. `LOGGING.md` (новый файл)
**Создано:**
- Подробная документация по использованию логирования
- Примеры вывода логов
- Советы по работе с логами

### 6. `CHANGELOG_LOGGING.md` (новый файл)
**Создано:**
- Этот файл с описанием всех изменений

## Особенности реализации

### Формат логов
```
[ГГГГ-ММ-ДД ЧЧ:ММ:СС] [УРОВЕНЬ] Сообщение
```

### Уровни логирования
- **INFO** - основная информация о выполнении
- **DEBUG** - детальная отладочная информация (только с флагом `-d`)
- **ERROR** - сообщения об ошибках

### Вывод логов
- Все логи выводятся в `stderr` (поток ошибок)
- Основной вывод команд остается в `stdout`
- Это позволяет разделить логи и результаты работы

## Примеры использования

### Просмотр только логов
```bash
./unifi --list 2>&1 > /dev/null
```

### Просмотр только результатов (без логов)
```bash
./unifi --list 2> /dev/null
```

### Сохранение логов в файл
```bash
./unifi --list 2> logs.txt
```

### Просмотр логов и результатов
```bash
./unifi --list 2>&1
```

### Отладочный режим
```bash
./unifi -d --list 2>&1
```

## Обратная совместимость

Все изменения полностью обратно совместимы:
- Существующие команды работают без изменений
- Логи выводятся в stderr, не мешая основному выводу
- Отладочный режим опционален

## Преимущества

1. **Улучшенная отладка** - легко отследить выполнение операций
2. **Мониторинг** - возможность записывать логи для анализа
3. **Прозрачность** - понятно что происходит на каждом этапе
4. **Временные метки** - точное время каждой операции
5. **Уровни детализации** - от базовых INFO до подробных DEBUG

## Тестирование

Все скрипты были протестированы:
- ✅ Основной скрипт `unifi` с различными командами
- ✅ Режим отладки `-d`
- ✅ Раннее определение DEBUG режима работает корректно
- ✅ Логи не мешают основному выводу (JSON, текст)
- ✅ Нет ошибок линтера

## Примеры вывода

### Базовый режим
```bash
$ ./unifi -v 2>&1
[2025-10-16 19:04:55] [INFO] Запуск UniFi CLI версии 0.1.3_alpha
[2025-10-16 19:04:55] [INFO] Загрузка конфигурационного файла: /path/to/unifi.conf
[2025-10-16 19:04:55] [INFO] Загрузка библиотеки API: unifi_sh_api
[2025-10-16 19:04:55] [INFO] Загрузка библиотеки API: unifi_sh_api_nonofficial
[2025-10-16 19:04:55] [INFO] Отображение версии
0.1.3_alpha
[2025-10-16 19:04:55] [INFO] Скрипт UniFi CLI завершил работу
```

### Отладочный режим
```bash
$ ./unifi -d -v 2>&1
[2025-10-16 19:04:55] [INFO] Запуск UniFi CLI версии 0.1.3_alpha
[2025-10-16 19:04:55] [DEBUG] Аргументы командной строки: -d -v
[2025-10-16 19:04:55] [DEBUG] Путь к скрипту: /path/to/unifi
[2025-10-16 19:04:55] [DEBUG] Директория скрипта: /path/to
[2025-10-16 19:04:55] [INFO] Загрузка конфигурационного файла: /path/to/unifi.conf
[2025-10-16 19:04:55] [INFO] Загрузка библиотеки API: unifi_sh_api
[2025-10-16 19:04:55] [INFO] Загрузка библиотеки API: unifi_sh_api_nonofficial
[2025-10-16 19:04:55] [INFO] Включен режим отладки (DEBUG)
[2025-10-16 19:04:55] [INFO] Отображение версии
0.1.3_alpha
[2025-10-16 19:04:55] [INFO] Скрипт UniFi CLI завершил работу
```

